Object.defineProperty(Object.prototype,"getProperty",{value:function(e){if(""===e)return this;let t,o=this,r=e.toString().split("."),s=r.length;for(t=0;t<s;t++){if(void 0===o[r[t]])return;o=o[r[t]]}return o}}),Object.defineProperty(Object.prototype,"setProperty",{value:function(e,t){let o,r=this,s=e.toString().split("."),i=s.length;for(o=0;o<i-1;o++)void 0===r[s[o]]&&(r[s[o]]={}),r=r[s[o]];r[s[i-1]]=t}}),Object.defineProperty(Object.prototype,"deleteProperty",{value:function(e){let t=this,o=e.toString().split(".");o.length>1&&(e=o[o.length-1],t=this.getProperty(o.slice(0,-1).join("."))),void 0!==t&&void 0!==t[e]&&delete t[e]}});var om={prefix:"",toastDelay:5e3,toastPosition:"bottom right",langs:{ru:{signup_in_progress:"Выполняется регистрация...",signin_in_progress:"Выполняется вход...",signin_success:"Вход успешно выполнен от имени",signout_in_progress:"Выполняется выход...",signout_success:"Выход выполнен успешно",edit_in_progress:"Изменение данных...",edit_success:"Изменения сохранены"}},codes:{0:"Успешно",1:"Внутренняя ошибка",2:"Доступ запрещен",100:"Отсутствует обязательный параметр",200:"Адрес электронной почты уже зарегистрирован",201:"Имя пользователя уже зарегистрировано",300:"Неправильный пароль",400:"Имя пользователя или адрес электронной почты не найден",401:"Сессия не найдена",500:"Некорректный адрес электронной почты",501:"Некорректное имя пользователя",502:"Некорректный пароль",503:"Некорректное имя пользователя или адрес электронной почты",504:"Некорректный идентификатор сессии"},sha:async e=>{let t=new TextEncoder("utf-8").encode(e);return t=await crypto.subtle.digest("sha-512",t),(t=Array.from(new Uint8Array(t))).map(e=>("00"+e.toString(16)).slice(-2)).join("")},random:e=>{let t=new Uint8Array(e||1);return crypto.getRandomValues(t),(t=Array.from(t)).map(e=>("00"+e.toString(16)).slice(-2)).join("")},getLocal:(e,t)=>{e=om.prefix+e;let o=localStorage.getItem(e);return void 0===t||null===t?o:(o=null===o?{}:JSON.parse(o),""===t?o:o.getProperty(t))},setLocal:(e,t,o)=>{e=om.prefix+e;let r=localStorage.getItem(e);void 0!==t&&null!==t?(r=null===r?{}:JSON.parse(r),""===t?r=o:r.setProperty(t,o),localStorage.setItem(e,JSON.stringify(r))):localStorage.setItem(e,o)},removeLocal:(e,t)=>{if(e=om.prefix+e,void 0!==t&&null!==t&&""!==t){let o=localStorage.getItem(e);(o=null===o?{}:JSON.parse(o)).deleteProperty(t),localStorage.setItem(e,JSON.stringify(o))}else localStorage.removeItem(e)}};angular.module("om",["ngResource"]).provider("$om",function(){var e=this;this.url="https://api.om.ua/",this.resources={},this.actions={get:{method:"GET"},post:{method:"POST"},put:{method:"PUT"},delete:{method:"DELETE"}},this.$get=["$resource",t=>o=>{if(void 0!==e[o])return e[o];switch(o){case"accounts":e[o]=t(e.url+"accounts/:id",{id:"@id"},e.actions);break;case"sessions":e[o]=t(e.url+"sessions/:session",{},e.actions);break;case"tokens":e[o]=t(e.url+"tokens/:token",{},e.actions)}return void 0!==e[o]?e[o]:void 0}]});var app=angular.module("app",["om","ngMaterial","ngRoute"]);app.config(["$mdThemingProvider","$mdIconProvider","$mdAriaProvider","$httpProvider","$locationProvider","$routeProvider",function(e,t,o,n,a,i){e.theme("default").primaryPalette("blue",{default:"700"}),t.defaultFontSet("FontAwesome").fontSet("fa","FontAwesome"),o.disableWarnings(),n.defaults.withCredentials=!0,a.html5Mode({enabled:!0,requireBase:!1}),i.when("/",{templateUrl:"/templates/root.html"}).when("/token",{templateUrl:"/templates/token.html"}).otherwise({redirectTo:"/"})}]),app.controller("controller",["$scope","$http","$location","$mdMedia","$mdSidenav","$mdToast","$om",function(e,t,o,n,a,i,s){e.isGt=(()=>n("gt-xs")),e.sidenav=!0,e.isLockedOpenSidenav=function(){return e.sidenav&&n("gt-md")},e.toggleSidenav=function(){n("gt-md")?e.sidenav=!e.sidenav:a("left").toggle()},e.hashToken=(()=>btoa(location.href)),e.checkToken=(()=>{if("/token/"!==o.path())return;e.message(om.langs.ru.signin_in_progress,!1);let n=JSON.parse(atob(o.hash()));e.id=n.id,e.token=n.token,om.setLocal("id",null,n.id),om.setLocal("token",null,n.token),t.defaults.headers.common["X-Auth-Token"]=n.token,s("accounts").get({id:n.id}).$promise.then(t=>{e.account=t,om.setLocal("account","",t),o.url(n.url),e.message(om.langs.ru.signin_success+" "+(t.firstname||t.username)+" "+t.email)})}),e.getToken=(()=>{e.id||s("tokens").post().$promise.then(o=>{e.id=o.id,e.token=o.token,om.setLocal("id",null,o.id),om.setLocal("token",null,o.token),t.defaults.headers.common["X-Auth-Token"]=o.token,s("accounts").get({id:o.id}).$promise.then(t=>{e.account=t,om.setLocal("account","",t)})})}),e.message=((e,t)=>{i.show(i.simple().content(e).hideDelay(void 0!==t?t:om.toastDelay).position(om.toastPosition))}),e.error=(t=>{e.message(om.codes[t.data.code]),e.state.loading=!1}),e.state={loading:!1},e.account={},e.id=om.getLocal("id"),e.id&&(e.account=om.getLocal("account",""),e.token=om.getLocal("token"),t.defaults.headers.common["X-Auth-Token"]=e.token),e.checkToken(),e.getToken(),e.input={digits:!0,low:!0,high:!0,special:!1,len:16},e.generate=function(){var t="";e.input.digits&&(t+="0123456789"),e.input.low&&(t+="abcdefghijklmnopqrstuvwxyz"),e.input.high&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),e.input.special&&(t+="()[]{}_=+-*/!|?^@&:;%$,."),e.output=[];let o,n,a,i=t.length;for(a=0;a<8;a++){for(n="";n.length<e.input.len;)o=new Uint8Array(1),crypto.getRandomValues(o),o[0]>i-1||(n+=t[o[0]]);e.output.push(n)}}}]);